# WebChat Application

A web-based chat application with webhook integration, user authentication, and theme customization.

## Prerequisites
- [Docker](https://docs.docker.com/get-docker/) and Docker Compose
- [Node.js](https://nodejs.org/) v18 or later

## Setup

1. Install dependencies and start the database:
   ```bash
   ./setup.sh
   ```
   The script checks for Docker and Node.js, installs backend and frontend dependencies, and launches PostgreSQL and Redis.

2. (Optional) Manually apply the database schema:
   ```bash
   psql -U webchat_user -d webchat_db -f database_schema.sql
   ```

## Development

1. Start all services:
   ```bash
   ./start.sh
   ```
   This starts the database containers, the Express backend, and the React development server.

   Services are available at:
   - Frontend: http://localhost:3000
   - Backend:  http://localhost:3001
   - PgAdmin:  http://localhost:8080

2. Stop services:
   ```bash
   ./stop.sh
   ```

## Production

1. Build and run the application in production mode:
   ```bash
   ./start_production.sh
   ```
   The script builds the frontend (if needed), starts the backend and static frontend server, and launches PostgreSQL and Redis.

## Environment Variables

| Variable | Location | Description | Default |
|----------|----------|-------------|---------|
| `POSTGRES_DB` | docker-compose | PostgreSQL database name | `webchat_db` |
| `POSTGRES_USER` | docker-compose | Database user | `webchat_user` |
| `POSTGRES_PASSWORD` | docker-compose | Database password | `Webchat2024!` |
| `PGDATA` | docker-compose | Data directory inside the container | `/var/lib/postgresql/data/pgdata` |
| `PGADMIN_DEFAULT_EMAIL` | docker-compose | PgAdmin login email | `teain1370@gmail.com` |
| `PGADMIN_DEFAULT_PASSWORD` | docker-compose | PgAdmin login password | `admin123` |
| `PGADMIN_LISTEN_PORT` | docker-compose | PgAdmin internal port | `80` |
| `HOST` | frontend start script | Address for React dev server | `0.0.0.0` |
| `DANGEROUSLY_DISABLE_HOST_CHECK` | frontend start script | Disable host checking in dev | `true` |

Application-specific settings such as server ports, JWT secrets, and email templates are stored in `backend/config.json`.

## Database Schema

The schema is defined in `database_schema.sql` and is automatically applied when PostgreSQL starts via Docker. It creates tables for users, chat sessions, messages, webhooks, logs, and themes.

To reapply the schema manually:
```bash
psql -U webchat_user -d webchat_db -f database_schema.sql
```

## Troubleshooting

- **Docker or Node.js missing** – rerun `./setup.sh` or install them manually.
- **Port already in use** – ensure ports 3000, 3001, 5432, 6379, and 8080 are free.
- **Database container not healthy** – check status with `docker-compose ps` and logs with `docker-compose logs postgres`.
- **Backend/frontend issues** – inspect `backend.log` and `frontend.log` generated by the start scripts.

## Contributing

1. Fork the repository and create a feature branch.
2. Make your changes and ensure code style matches the existing project.
3. Run tests before submitting:
   ```bash
   cd backend && npm test
   cd ../frontend && npm test -- --watchAll=false
   ```
4. Open a pull request with a clear description of your changes.

---

The provided scripts assume a Unix-like environment.
